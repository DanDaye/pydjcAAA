<!DOCTYPE html>
<html lang="en-us" id="extr-page">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../css/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
<link rel="stylesheet" href="../../css/ztree/zTree.css" type="text/css">
<link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
<link rel="stylesheet" href="../../css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="../../css/bootstrap-table.css" type="text/css">
<link rel="stylesheet" href="../../css/common.css" type="text/css">
</head>

<style type="text/css">

	.table > thead > tr > th, .table > tbody > tr > td, .table > thead > tr > td {
	    padding: 0px;
	    border-top: 0px solid #c3c3c3;
	    border-left: 0px solid #c3c3c3;
	    border-right: 0px solid #c3c3c3; 
	    border-bottom: 0px solid #c3c3c3; 
	}
	.innerbox::-webkit-scrollbar {/*滚动条整体样式*/
          width: 4px;     /*高宽分别对应横竖滚动条的尺寸*/
          height: 4px;
     }
    .innerbox::-webkit-scrollbar-thumb {/*滚动条里面小方块*/
          border-radius: 5px;
          -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
          background: rgba(0,0,0,0.2);
    }
    .innerbox::-webkit-scrollbar-track {/*滚动条里面轨道*/
          -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
          border-radius: 0;
          background: rgba(0,0,0,0.1);
    }
	
</style>
<body>
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	
		<table class="table" border=1 style="height:110px;" >
		  <tr>
			  <td style="width:25%;text-align:center;borde: 0px solid rgb(195, 195, 195)" align="center">
			  
	             <table style=" height:100%;width:70%;background-color: #359cb6 !important;border: 1px solid #dddddd;margin: 0 auto;">
	                	<tr style="color:white;"><td align=left style="text-indent: 10px;width:60%">主变台数</td><td align=left>3 台</td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="text-indent: 10px;">主变容量</td><td align=left>1400 kVA</td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="text-indent: 10px;">检测分路个数</td><td align=left>100 个</td>
	                	</tr>
	                	<tr style="height: 25%;"><td colspan=2 style="color: #000000;background-color: #dbdbdb;font-size: 16px;"> 基本概况</td>
	                	</tr>
	            </table>
	           </td>
	           <td style="width:25%" align=right>
	                <table style=" height:100%;width:70%;background-color: #dd4b39 !important;border: 1px solid #dddddd;margin: 0 auto;">
	                	<tr style="color:white;"><td align=left style="text-indent: 10px;width:60%">日累计电量</td><td align=left id="dayEp"></td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="    text-indent: 10px;">本月累计电量</td><td align=left  id="monthEp"></td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="    text-indent: 10px;">上月累计电量</td><td align=left  id="lastMonthEp"></td>
	                	</tr>
	                	<tr style="height: 25%;"><td colspan=2 style="color: #000000;background-color: #dbdbdb;font-size: 16px;"> 电量概况 </td>
	                	</tr>
	                </table>
	                
	                
	           </td>
	             <td style="width:25%">
	         
	             
	             <table style=" height:100%;width:70%;background-color: #f39c12 !important;border: 1px solid #dddddd;margin: 0 auto;">
	                	<tr style="color:white;"><td align=left style="text-indent: 10px;width:60%">日最大负荷</td><td align=left  id="dayP"></td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="    text-indent: 10px;">本月最大负荷</td><td align=left  id="monthP"></td>
	                	</tr>
	                	<tr style="color:white;"><td align=left style="    text-indent: 10px;">本年最大负荷</td><td align=left  id="lastMonthP"></td>
	                	</tr>
	                	<tr style="height: 25%;"><td colspan=2 style="color: #000000;background-color: #dbdbdb;font-size: 16px;"> 负荷概况 </td>
	                	</tr>
	                </table>
	            </td>
	           	 <td style="width:25%">
	               <table style=" height:100%;width:70%;background-color: #009688 !important;border: 1px solid #dddddd;margin: 0 auto;">
	                
	                	<tr style="color:white;height: 50%;"><td align=left style="text-indent: 10px;width:60%;font-size: 16px;">安全用电</td><td align=left>40 天</td>
	                	</tr>
	                	
	                		<tr style="color:white;"><td align=left style="text-indent: 10px;">用电异常预警</td><td align=left>0 起</td>
	                	</tr>
	                
	                	<tr style="height: 25%;"><td colspan=2 style="color: #000000;background-color: #dbdbdb;font-size: 16px;"> 安全用电</td>
	                	</tr>
	                </table>
	            </td>
		  </tr>
		</table>
	
	</div>
	
	<div class="box col-xs-12 col-sm-12 col-md-12 col-lg-12" class="form-inline" style="width:100%;margin-top: 0px; overflow: hidden;" > 
		    <table style="width:100%">
		    
		        <tr>
		          <td  style="width: 48%;">
        		  		<div class='title' style="    float: left;color: #3c3c3c;font-size: 18px;font-weight: 600;line-height: 30px;">
					        <i class="layui-icon">&#xe62c;</i>日负荷
					    </div>
		          </td>
		          <td style="width: 4%;"></td>
		          <td>
		          	 <div class='title' style="    float: left;color: #3c3c3c;font-size: 18px;font-weight: 600;line-height: 30px;">
					    <i class="layui-icon">&#x1002;</i>告警列表
					 </div>
		          </td>
		        </tr>
			    <tr>
				    <td  style="border: 1px solid #c3c3c3;width: 48%;">

						<div id="chart" style="height:180px;"></div>

					</td>
				    <td style="width: 4%;"></td>
					<td style="border: 1px solid #c3c3c3;width: 48%;">
						<div id="alarm" class="innerbox" style="width:550px;height:180px;overflow:auto">
								<div class='row-fluid recent-activity' style="width:100%">
									<div id="alarmList" class='box-content box-no-padding' style="width:100%">
									
									</div>
								</div>
						
						</div>
					</td>
				</tr>
 			</table>
	</div>
	
	
	<div class="box col-xs-12 col-sm-12 col-md-12 col-lg-12" class="form-inline" style="width:100%;margin-top: 0px; overflow: hidden;" > 
		    <table style="width:100%" >
		    
		        <tr>
		          <td  style="width: 48%;">
        		  		<div class='title' style="    float: left;color: #3c3c3c;font-size: 18px;font-weight: 600;line-height: 30px;">
					        <i class="layui-icon">&#xe62c;</i>月用电
					    </div>
		          </td>
		         
		        </tr>
			    <tr>
				    <td  style="border: 1px solid #c3c3c3;">
						<div id="epChart" style="height:150px;"></div>
					</td>
				</tr>
 			</table>
	</div>
	

	<script type="text/javascript" src="../../js/libs/jquery.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/libs/jquery.ztree.all-3.5.min.js"></script>
	<script type="text/javascript" src="../../js/module/ztree-device.js"></script>
	<script type="text/javascript" src="../../js/module/elec/dayElectricList.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../js/plugin/mqttws31.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstraptable/bootstrap-table.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../js/plugin/bootstraptable/bootstrap-table-zh-CN.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrap/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../js/plugin/echarts/echarts.js"></script>
	<script type="text/javascript" src="../../js/libs/jquery.query-2.1.7.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../js/plugin/mqttws31.js"></script>
	
	<script type="text/javascript">
	 
		layui.use(['layer','laydate'], function(){
		    var layer = layui.layer;
		});

		var arry = [];
		
		function initP(){
			$.ajax({
				type : 'get',
				url : '/home/info',
				async : false,
				success : function(data) {
					 $("#dayP").text(data.dayP + " kw");
					 $("#monthP").text(data.monthp + " kw");
					 $("#lastMonthP").text(data.lastMonthP + " kw");
				
					 $("#dayEp").text(data.dayEp + " kWh");
					 $("#monthEp").text(data.monthEp + " kWh");
					 $("#lastMonthEp").text(data.monthEp + " kWh");
				}
			});
			
			
			$.ajax({
				type : 'get',
				url : '/home/chart',
				async : false,
				success : function(data) {
		
					var chart = echarts.init(document.getElementById('chart'));
					
					option = {
					
						    tooltip: {
						        trigger: 'axis',
						        axisPointer: {
						            animation: false
						        }
						    },
						    grid: [{
						    	   left: '15px',
							       right: '5%',
							       top: '18%',
							       bottom: '13%',
							       containLabel: true
						    }],
						    legend: {
						    	 left: 'right',
						         data: ['昨日', '今日']
						    },
						    
						    xAxis: {
						    	type: 'category',
						    	boundaryGap: false,
						        splitLine: {
						            show: false
						        },
						        data: data.label,
						        axisLabel:{
						        	color:'#000000',  
					                 //X轴刻度配置
					                 interval:5 //0：表示全部显示不间隔；auto:表示自动根据刻度个数和宽度自动设置间隔个数
					            },
					            axisLine:{  
	                                lineStyle:{  
	                                	type: 'solid',
	                                    color:'#337ab7',  
	                                    width:2//这里是为了突出显示加上的  
	                                }  
	                            }  
						    },
						    
						    yAxis: {
						    	name : '单位(kv)',
						        type: 'value',
						        boundaryGap: [0, '100%'], 
						        splitLine: {
						            show: false
						        },
						        axisLabel:{
						        	color:'#000000',  
					            },
						        axisLine:{  
	                                lineStyle:{  
	                                	type: 'solid',
	                                    color:'#337ab7',  
	                                    width:2//这里是为了突出显示加上的  
	                                }  
	                            }  
						    },
						   
						    series: [{
						        name: '昨日',
						        type: 'line',
						        showSymbol: false,
						        hoverAnimation: false,
						        data:data.lastValue
						    },{
						        name: '今日',
						        type: 'line',
						        showSymbol: false,
						        hoverAnimation: false,
						        data:data.value
						    }]
					};
	
					  // 为echarts对象加载数据 
			        chart.setOption(option); 
					
				}
			});
		}
		
		function initEp(){
			$.ajax({
				type : 'get',
				url : '/home/chartEp',
				async : false,
				success : function(data) {
					var chart = echarts.init(document.getElementById('epChart'));
					
					option = {
						    tooltip : {
						        trigger: 'axis',
						        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
						            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
						        }
						    },
						    grid: [{
						    	   left: '55px',
							       right: '2%',
							       top: '20%',
							       bottom: '23%'
						    }],
						    legend: {
						    	 left: 'right',
						         data: ['上月电量', '本月电量']
						    },
						    
						    xAxis: {
						    	type: 'category',
						        data: data.label,
						        axisLabel:{
						        	color:'#000000',  
					            },
					            axisTick: {
					                alignWithLabel: true
					            },
						        axisLine:{  
	                                lineStyle:{  
	                                	type: 'solid',
	                                    color:'#337ab7',  
	                                    width:2//这里是为了突出显示加上的  
	                                }  
	                            }  
						    },
						    
						    yAxis: {
						    	name : '单位(kWh)',
						        type: 'value',
						        boundaryGap: [0, '100%'],
						        splitLine: {
						            show: false
						        },
						        axisLabel:{
						        	color:'#000000',  
					            },
						        axisLine:{  
	                                lineStyle:{  
	                                	type: 'solid',
	                                    color:'#337ab7',  
	                                    width:2//这里是为了突出显示加上的  
	                                }  
	                            }  
						    },
						   
						    series: [{
						        name: '上月电量',
						        type: 'bar',
						        showSymbol: false,
						        hoverAnimation: false,
						        data:data.lastData
						    },{
						        name: '本月电量',
						        type: 'bar',
						        showSymbol: false,
						        hoverAnimation: false,
						        data:data.currentData
						    }]
					};
	
					  // 为echarts对象加载数据 
			        chart.setOption(option); 
				}
			});
		}
		
		var client;
		var index=0;
		doConnect();









		function doConnect() {
		    console.log("connect invoked");
		    // client = new Paho.MQTT.Client("10.82.58.95", Number(8080), "/mqtt", "clientId1");
		    
		    client = new Paho.MQTT.Client("118.31.2.207", Number(8080), "/mqtt", "clientId123");
		    //client = new Paho.MQTT.Client("test.mosquitto.org", Number(8080), "", "clientId1");
		    //client = new Paho.MQTT.Client("ws://whistler1.hursley.ibm.com", Number(1883), "ClientId");

		    client.startTrace();
		    // set callback handlers
		    client.onConnectionLost = onConnectionLost;
		    client.onMessageArrived = onMessageArrived;

		    // connect the client
		    client.connect({onSuccess:onConnect});
		    console.log("connect finished");
		}


		// called when the client connects
		function onConnect() {
		    // Once a connection has been made, make a subscription and send a message.
		    console.log("onConnect");
		    client.subscribe("alarm2web");
		    
		}

		// called when the client loses its connection
		function onConnectionLost(responseObject) {
		    if (responseObject.errorCode !== 0) {
		      console.log("onConnectionLost:"+responseObject.errorMessage);
		    }
		}

		// called when a message arrives
		function onMessageArrived(message) {
		    console.log("onMessageArrived:"+message.payloadString +"\t"+(index++));
		    var arry = JSON.parse(message.payloadString);

		    if(arry.length > 0){
		    	var table = '<table id="dt-table" class="table table-striped table-bordered table-hover" border=3 style="width:100%;">';
				
				for( var i = 0; i < arry.length; i ++){
					table +=  '<tr>';
					table +=  '<td width="80%" style="text-align: left; padding: 8px;color: #f34541 !important;">';

					if("0" == arry[i].type){
						table +=  arry[i].deviceName +':'+arry[i].measPointName+ " "+arry[i].alarmTypeName ;
					}else{
						table +=  arry[i].content ;
					}
					table +=  '</td>';
					table +=  '<td>';
					table +=  arry[i].beginTime + ' <i class="layui-icon" style="color:#3c3c3c">&#xe60e;</i>';
                    table +=  '</td>';
                    table +=  '</tr>';
				}
				
				table += '</table>';
				    
	            $("#alarmList").text("");
				$("#alarmList").append(table);
			}  
		}

		
		$.ajax({
			type : 'get',
			url : '/alm/alarm/getCurrentAlarmList',
			success : function(arry) {
				   if(arry.length > 0){
					   var table = '<table id="dt-table" class="table table-striped table-bordered table-hover" border=3 style="width:100%;">';
						
						for( var i = 0; i < arry.length; i ++){
							table +=  '<tr>';
							table +=  '<td width="80%" style="text-align: left; padding: 8px;color: #f34541 !important;">';
		
							if("0" == arry[i].type){
								table +=  arry[i].deviceName +':'+arry[i].measPointName+ " "+arry[i].alarmTypeName ;
							}else{
								table +=  arry[i].content ;
							}
							
							table +=  '</td>';
							table +=  '<td>';
							table +=  arry[i].beginTime + ' <i class="layui-icon" style="color:#3c3c3c">&#xe60e;</i>';
		                    table +=  '</td>';
		                    table +=  '</tr>';
						}
						
						table += '</table>';
						    
			            $("#alarmList").text("");
						$("#alarmList").append(table);
				   }
			
			}
		});
		// initP();
		// initEp();
	</script>
</body>
</html>